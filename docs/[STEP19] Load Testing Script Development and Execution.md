## [STEP19] Load Testing Script Development and Execution
- **부하 테스트 대상 선정 및 목적, 시나리오 등의 계획을 세우고 이를 문서로 작성**
- **적합한 테스트 스크립트를 작성하고 수행**

---

## 부하 테스트 대상
### 인기 판매 상품 조회
**API 선정 사유**
- 빈번하게 조회가 되는 기능이기에 병목 현상이 발생할 수 있다고 판단되어 선정하였습니다.
- DB에 부담이 되는 집계 함수와 여러 테이블을 조인하는 무거운 쿼리를 사용하기에 캐싱을 사용했을 때의 성능 비교를 확인을 하기 위해 선정하였습니다.

### 부하 테스트 방식
부하테스트는 k6 라이브러리를 통해서 진행하였으며 조회 기능이기에 목표 TPS는 1000으로 설정하였습니다.

**예시 코드**
```angular2html

export const options = {
    scenarios: {
        constant_request_rate: {
        executor: 'constant-arrival-rate',
        rate: 1000,             // 초당 1000 요청
        timeUnit: '1s',         // 단위: 1초
        duration: '60s',        // 60초 동안 실행
        preAllocatedVUs: 100,   // 사전 할당 VU 수
        maxVUs: 200,            // 필요시 최대 VU까지 확장
        },
    },
};

export default function () {
    let res = http.get('http://localhost:8080/products/popular');
    check(res, { 'status is 200': (r) => r.status === 200 });
}
```
비교 데이터는 아래와 같은 상황을 기반으로 준비하였습니다. 
- 단순 Mysql을 조회하였을 때
- Redis에 정각마다 최근 3일간 판매된 상품 데이터를 집계하여 저장한 데이터를 사용하였을 때

### 단순 Mysql을 조회하였을 때
![이미지](이미지링크~)
DB에 담긴 더미데이터는 3000여개에 불과했지만 그럼에도 낮은 성능을 보여주는 모습입니다.
<br> 목표 TPS에는 전혀 미치지 못하는 상황이며 응답 시간 또한 가장 오래 걸린 시간의 경우 3.5초가 넘어가는 상황입니다.

### Redis에 정각마다 최근 3일간 판매된 상품 데이터를 집계하여 저장한 데이터를 사용하였을 때
![이미지](이미지링크~)
그에 반해 Redis에 집계된 데이터를 조회하는 상황의 경우 좋은 성능을 보여주는 모습입니다.
<br> 목표 TPS에도 인접하였으며 응답 시간 또한 가장 오래 걸린 경우에도 500ms인 모습을 보여주고 있습니다.


### 요약
| 항목 | Redis                       | Mysql                       | 비교 |
|------|-----------------------------|-----------------------------|------------|
| **총 요청 수** | 59,717                      | 20,966                      | 0.35배 |
| **성공 요청** | 59,717 (100%)               | 20,966 (100%)               | 0.35배 |
| **평균 응답 시간** | 10.51 ms                    | 568.15 ms                   | 54.1배 |
| **최소 응답 시간** | 3.94 ms                     | 24.08 ms                    | 6.11배 |
| **중간 응답 시간** | 6 ms                        | 554.06 ms                   | 92.3배 |
| **최대 응답 시간** | 513.95 ms                   | 3.76 s                      | 7.32배 |



