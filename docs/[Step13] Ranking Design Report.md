## [Step13] Ranking Design Report
- **가장 많이 주문한 상품 랭킹을 Redis 기반으로 설계**  
- **설계를 기반으로 개발 및 구현**

---

### 1. 인기 판매 상품 조회 기능 개요
- 3일간 판매 수량이 많은 3개의 상품을 조회

### 2. 인기 판매 상품 조회 구현 방식
1. 결제 시 Redis의 Sorted Set 자료구조로 아래와 같은 형태로 데이터 주입되며 상품 ID가 동일 할 경우 매 결제시 마다 score가 증가 합니다.
```
Key: product:sales:2025-08-22 
value: 상품ID,
score: 주문 수량
```
2. 매 00:05분 마다 최근 3일의 데이터를 집계하여 Sorted Set 자료구조의 `product:sales:3days:total`라는 새로운 키를 생성 혹은 갱신
3. 인기 상품 조회 요청시 `product:sales:3days:total`를 score의 역순으로 상품 ID를 조회하여 DB를 조회 후 반환

### 3. 인기 판매 상품 조회 구현 방식 결정 배경
- 상품 데이터를 레디스에서 관리하면 조회가 성능이 더욱 좋으나 아래와 같은 이유로 DB에서 조회하는 방식으로 변경 하였습니다.
  - DB와 레디스 간의 상품 정합성 문제
  - Redis의 의존성 증가
  - 같은 데이터를 다른 두 곳에서 관리를 함으로서 관리 포인트 증가
  - DB에서 PK로 조회하기에 클러스터링 인덱스로 인해 성능상의 이슈가 크게 생기지 않음
- 데이터를 주입 시 Expire를 `TimeUnit.DAYS`가 아닌 `TimeUnit.SECONDS`으로 설정하여 혹시 모를 캐시 스탬피드를 예방
- 위와 비슷한 예시로 `@Scheduled`로 4일전의 데이터를 정각에 지우며 5분이 지난 후에 3일간의 데이터를 집계하였습니다.
   

### 4. 인기 상품 조회 코드
- [인기상품조회 구현 및 테스트 코드 작성](425cf6f)
- [인기상품조회 Scheduled 코드 및 Repository 코드 작성](7079b9b)
